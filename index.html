<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini's IPA Repo - Tweaked iOS Apps</title>
    <meta name="description" content="Premium tweaked applications for iOS 15+. Featuring Spotify, YouTube, Twitter clients and more.">
    <meta name="keywords" content="iOS apps, tweaked apps, SideStore, TrollApps, Feather, IPA repository, spotify, youtube, minecraft, torrent">
    <meta name="author" content="Mini">
    <meta name="robots" content="index, follow">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   img-src https: data: blob:; 
                   script-src 'self'; 
                   style-src 'self' 'unsafe-inline';
                   connect-src https:;
                   frame-src 'none';
                   object-src 'none';
                   base-uri 'self';
                   form-action 'self'">

    <meta property="og:title" content="Mini's IPA Repo - Tweaked iOS Apps">
    <meta property="og:description" content="Premium tweaked applications for iOS 15+">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://oofmini.github.io/Minis-IPA-Repo/">
    <meta property="og:image" content="https://OofMini.github.io/Minis-IPA-Repo/apps/repo-icon.png">

    <!-- Prevent caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Preconnect to important domains -->
    <link rel="preconnect" href="https://OofMini.github.io">
    <link rel="preconnect" href="https://github.com">
    <link rel="dns-prefetch" href="https://OofMini.github.io">
    <link rel="dns-prefetch" href="https://github.com">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mini's IPA Repo">
    <link rel="apple-touch-icon" href="https://OofMini.github.io/Minis-IPA-Repo/apps/repo-icon.png">
    <link rel="apple-touch-startup-image" href="https://OofMini.github.io/Minis-IPA-Repo/apps/repo-icon.png">

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Mini's IPA Repo",
        "description": "Premium tweaked applications for iOS 15+",
        "url": "https://oofmini.github.io/Minis-IPA-Repo/",
        "applicationCategory": "Utilities",
        "operatingSystem": "iOS"
    }
    </script>

    <style>
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --card-bg: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            --card-border: rgba(255,255,255,0.15);
            --accent-color: #a0a0ff;
            --success-color: #1db954;
            --info-color: #007AFF;
            --warning-color: #ffaa00;
            --error-color: #ff4444;
            --trollapps-color: #8a2be2;
            --sidestore-color: #1db954;
            --feather-color: #ff6b35;
            --animation-timing: cubic-bezier(0.4, 0, 0.2, 1);
            --search-debounce: 300ms;
            --toast-duration: 3000ms;
            --fetch-timeout: 8000ms;
            --skeleton-delay: 800ms;
            --border-radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Focus styles for accessibility */
        :focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        :focus:not(:focus-visible) {
            outline: none;
        }

        /* Motion preferences */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .animated-gradient {
                animation: none !important;
                background: var(--text-color) !important;
                -webkit-background-clip: initial !important;
                -webkit-text-fill-color: initial !important;
                background-clip: initial !important;
            }
        }

        /* Utility classes */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.5s var(--animation-timing),
                        transform 0.5s var(--animation-timing);
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .fade-in-left {
            opacity: 0;
            transform: translateX(-30px);
            transition: opacity 0.5s var(--animation-timing),
                        transform 0.5s var(--animation-timing);
        }

        .fade-in-left.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .stagger-1 { transition-delay: 0.15s; }
        .stagger-2 { transition-delay: 0.3s; }
        .stagger-3 { transition-delay: 0.45s; }

        /* Animated Gradient for Title */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .animated-gradient {
            background: linear-gradient(270deg, #8a2be2, #ffffff, #8a2be2);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 4s ease infinite;
        }

        /* Layout */
        .hero {
            background: var(--bg-color);
            padding: clamp(20px, 5vw, 40px) 15px clamp(15px, 3vw, 25px);
            border-bottom: 1px solid var(--card-border);
            text-align: center;
        }

        .repo-icon {
            width: 60px;
            height: 60px;
            border-radius: 14px;
            margin-bottom: 10px;
            border: 2px solid var(--card-border);
            object-fit: contain;
        }

        .hero h1 {
            font-size: clamp(1.5em, 4vw, 2em);
            font-weight: 800;
            margin: 0 0 5px;
        }

        .hero-subtitle {
            font-size: clamp(0.9em, 2vw, 1em);
            margin: 0 0 20px;
            opacity: 0.9;
        }

        .badges {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .badge {
            background: var(--success-color);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge.purple { background: var(--accent-color); }

        .cta-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .cta-button {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            color: white;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: none;
            font-size: 0.9em;
            cursor: pointer;
            text-decoration: none;
        }

        .cta-button.trollapps { background: var(--trollapps-color); }
        .cta-button.sidestore { background: var(--sidestore-color); }
        .cta-button.feather { background: var(--feather-color); }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .cta-button:active { transform: translateY(0); }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px 15px;
        }

        .search-container {
            max-width: 500px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .search-box {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--card-border);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .search-box:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(160, 160, 255, 0.1);
        }

        .search-box::placeholder {
            color: var(--text-color);
            opacity: 0.7;
        }

        /* App Grid */
        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .app-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s var(--animation-timing),
                        border-color 0.3s ease,
                        box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .app-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        .app-icon-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 6px;
            border: 2px solid var(--card-border);
        }

        .app-icon {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 16px;
        }

        .app-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 0.85em;
            color: var(--success-color);
            flex-wrap: wrap;
        }

        .download-count {
            font-size: 0.8em;
            opacity: 0.8;
            color: var(--text-color);
        }

        .app-card-content {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .app-card h3 {
            margin: 0 auto 12px;
            color: var(--text-color);
            font-size: 1.2em;
            font-weight: 700;
            line-height: 1.3;
        }

        .app-card p {
            font-size: 0.9em;
            color: var(--text-color);
            opacity: 0.8;
            line-height: 1.5;
            margin: 0 auto 20px;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 20px;
            border-radius: 10px;
            background: linear-gradient(45deg, var(--success-color), #1ed760);
            color: #fff;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-weight: 700;
            font-size: 0.9em;
            margin-top: auto;
            border: none;
            cursor: pointer;
            text-decoration: none;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(29, 185, 84, 0.3);
        }

        .download-btn:active { transform: translateY(0); }

        /* Repo Info */
        .repo-info {
            margin-top: 40px;
            padding: 25px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--card-border);
            text-align: center;
        }

        .repo-info h3 {
            color: var(--text-color);
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .repo-link {
            margin: 12px 0;
            font-size: 1em;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .repo-link a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
            word-break: break-all;
        }

        .repo-link a:hover { color: var(--success-color); }

        .repo-link code {
            background: var(--card-bg);
            padding: 4px 10px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            color: var(--text-color);
            font-size: 0.85em;
            word-break: break-all;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 15px;
            right: 15px;
            padding: 12px 16px;
            background: var(--success-color);
            color: white;
            border-radius: 8px;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s var(--animation-timing),
                        opacity 0.3s ease;
            z-index: 1000;
            font-size: 0.9em;
            max-width: min(300px, calc(100vw - 30px));
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error { background: var(--error-color); }
        .toast.warning { background: var(--warning-color); }
        .toast.info { background: var(--info-color); }
        .toast.success { background: var(--success-color); }

        .install-prompt {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .install-prompt button {
            background: var(--accent-color);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            white-space: nowrap;
        }

        /* Loading States */
        .skeleton {
            background: linear-gradient(90deg, 
                rgba(255,255,255,0.1) 25%, 
                rgba(255,255,255,0.2) 50%, 
                rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--border-radius);
            padding: 20px;
            height: 280px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .skeleton-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            margin: 0 auto 15px;
        }

        .skeleton-text {
            height: 16px;
            margin-bottom: 8px;
            width: 100%;
        }

        .skeleton-text.short { width: 60%; }
        .skeleton-text.medium { width: 80%; }
        .skeleton-button {
            height: 40px;
            border-radius: 10px;
            margin-top: auto;
            width: 150px;
        }

        /* Error State */
        .error-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
        }

        .error-emoji {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .error-title {
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .error-message {
            margin-bottom: 20px;
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-grid {
                grid-template-columns: 1fr;
            }
            
            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .cta-button {
                width: 180px;
            }
            
            .fade-in-left {
                transform: translateY(30px);
            }
            
            .fade-in-left.visible {
                transform: translateY(0);
            }
            
            .repo-link {
                flex-direction: column;
                gap: 5px;
                text-align: center;
            }
            
            .toast {
                left: 15px;
                right: 15px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px 10px;
            }
            
            .app-card {
                padding: 15px;
            }
            
            .repo-info {
                padding: 20px 15px;
            }
        }

        @media (prefers-color-scheme: light) {
            :root {
                --bg-color: #f5f5f7;
                --text-color: #1d1d1f;
                --card-bg: linear-gradient(145deg, 
                    rgba(255,255,255,0.9), 
                    rgba(255,255,255,0.7));
                --card-border: rgba(0,0,0,0.1);
            }
            
            .animated-gradient {
                background: linear-gradient(270deg, #8a2be2, #1d1d1f, #8a2be2);
            }
        }
    </style>
</head>
<body>
    <header class="hero">
        <img src="https://OofMini.github.io/Minis-IPA-Repo/apps/repo-icon.png" 
             srcset="https://OofMini.github.io/Minis-IPA-Repo/apps/repo-icon.png 1x,
                     https://OofMini.github.io/Minis-IPA-Repo/apps/repo-icon@2x.png 2x"
             alt="Repository icon for Mini's IPA Repo" 
             class="repo-icon" 
             loading="lazy" 
             width="60" 
             height="60">
        <h1 class="animated-gradient">Mini's IPA Repo</h1>
        <p class="hero-subtitle">Tweaked IPAs</p>

        <div class="badges" role="status" aria-live="polite">
            <span class="badge" aria-label="Repository status active">‚úÖ Active</span>
            <span class="badge purple" aria-label="Supports iOS 15 and above">üì± iOS 15+</span>
        </div>

        <nav class="cta-buttons" aria-label="Add repository to app">
            <button type="button" class="cta-button trollapps" onclick="addToApp('TrollApps')" aria-label="Add repository to TrollApps">
                <span aria-hidden="true">üì±</span> Add to TrollApps
            </button>
            <button type="button" class="cta-button sidestore" onclick="addToApp('SideStore')" aria-label="Add repository to SideStore">
                <span aria-hidden="true">‚öôÔ∏è</span> Add to SideStore
            </button>
            <button type="button" class="cta-button feather" onclick="addToApp('Feather')" aria-label="Add repository to Feather">
                <span aria-hidden="true">ü™∂</span> Add to Feather
            </button>
        </nav>
    </header>

    <main class="container">
        <!-- Search box -->
        <section class="search-container fade-in" aria-labelledby="search-title">
            <h2 id="search-title" class="sr-only">Search apps</h2>
            <input type="search" 
                   class="search-box" 
                   id="searchBox" 
                   placeholder="üîç Search apps by name or description..." 
                   aria-label="Search apps by name or description"
                   autocomplete="off">
        </section>

        <!-- App grid -->
        <section class="app-grid" id="appGrid" aria-label="Available apps"></section>

        <!-- Repo info -->
        <section class="repo-info fade-in" aria-labelledby="repo-info-title">
            <h3 id="repo-info-title">üì¶ Repository Information</h3>

            <div class="repo-link fade-in-left stagger-1">
                <span aria-hidden="true">üåê</span>
                <strong>Official Website:</strong>
                <a href="https://oofmini.github.io/Minis-IPA-Repo/" target="_blank" rel="noopener noreferrer">
                    https://oofmini.github.io/Minis-IPA-Repo/
                </a>
            </div>

            <div class="repo-link fade-in-left stagger-2">
                <span aria-hidden="true">üì±</span>
                <strong>SideStore Manifest:</strong>
                <code>https://OofMini.github.io/Minis-IPA-Repo/sidestore.json</code>
            </div>

            <div class="repo-link fade-in-left stagger-3">
                <span aria-hidden="true">üßå</span>
                <strong>TrollApps Manifest:</strong>
                <code>https://OofMini.github.io/Minis-IPA-Repo/trollapps.json</code>
            </div>

            <div class="repo-link fade-in-left stagger-3">
                <span aria-hidden="true">ü™∂</span>
                <strong>Feather Manifest:</strong>
                <code>https://OofMini.github.io/Minis-IPA-Repo/feather.json</code>
            </div>
        </section>
    </main>

    <footer class="container" aria-label="Site footer">
        <p style="opacity:0.6; text-align:center; font-size:0.85em; padding:15px 0;">
            ¬© Mini ‚Äî Tweaked IPAs for iOS 15+. External downloads may be hosted off-site.
        </p>
    </footer>

    <div class="toast" id="toast" aria-live="polite" role="status" aria-atomic="true"></div>

    <script>
        // ==================== CONSTANTS & CONFIG ====================
        const CONFIG = {
            SEARCH_DEBOUNCE: 300,
            TOAST_DURATION: 3000,
            FETCH_TIMEOUT: 8000,
            SKELETON_DELAY: 800,
            MAX_SEARCH_RESULTS: 50,
            CACHE_TTL: 5 * 60 * 1000
        };

        const TIMESTAMP = Date.now();
        let toastTimeout = null;

        // ==================== UTILITY FUNCTIONS ====================
        const Utils = {
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            },

            formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            },

            isValidUrl(url) {
                try {
                    const parsed = new URL(url);
                    return parsed.protocol === 'https:';
                } catch {
                    return false;
                }
            },

            async copyToClipboard(text) {
                try {
                    if (navigator.clipboard?.writeText) {
                        await navigator.clipboard.writeText(text);
                        return true;
                    }
                    
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.select();
                    const success = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    return success;
                } catch (error) {
                    console.error('Copy failed:', error);
                    return false;
                }
            },

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            encodeAppId(id) {
                return encodeURIComponent(id).replace(/%20/g, '-');
            },

            decodeAppId(encoded) {
                return decodeURIComponent(encoded.replace(/-/g, '%20'));
            }
        };

        // ==================== ERROR HANDLING ====================
        class AppError extends Error {
            constructor(message, type = 'error') {
                super(message);
                this.name = 'AppError';
                this.type = type;
            }
        }

        // ==================== DATA MANAGER ====================
        class DataManager {
            constructor() {
                this.apps = [];
                this.filteredApps = [];
                this.searchCache = new Map();
                this.cacheTimestamp = 0;
            }

            getAppsData() {
                return [
                    {
                        id: 'eeveespotify',
                        name: 'EeveeSpotify',
                        developer: 'whoeevee',
                        description: 'Tweaked Spotify with premium features unlocked, no ads, and enhanced playback. Spotify IPA 9.1.0, EeveeSpotify v6.2.2',
                        icon: `https://OofMini.github.io/Minis-IPA-Repo/apps/EeveeSpotify.png?${TIMESTAMP}`,
                        version: '9.1.0',
                        downloadUrl: `https://github.com/OofMini/eeveespotifyreborn/releases/download/New/EeveeSpotify.ipa?${TIMESTAMP}`,
                        downloads: 0
                    },
                    {
                        id: 'ytlite',
                        name: 'YTLite',
                        developer: 'dayanch96',
                        description: 'Tweaked YouTube with background playback, no ads, and picture-in-picture. YouTube IPA 20.47.3, YTLite v5.2b4',
                        icon: `https://OofMini.github.io/Minis-IPA-Repo/apps/YouTubePlus_5.2b3.PNG?${TIMESTAMP}`,
                        version: '20.47.3',
                        downloadUrl: `https://github.com/OofMini/YTLite/releases/download/New/YouTubePlus_5.2b4.ipa?${TIMESTAMP}`,
                        downloads: 0
                    },
                    {
                        id: 'neofreebird',
                        name: 'X (NeoFreeBird)',
                        developer: 'NeoFreeBird',
                        description: 'Tweaked Twitter/X with premium features and more. X IPA 11.43.1, NeoFreeBird v5.2',
                        icon: `https://OofMini.github.io/Minis-IPA-Repo/apps/NeoFreeBird.png?${TIMESTAMP}`,
                        version: '11.43.1',
                        downloadUrl: `https://github.com/OofMini/tweak/releases/download/New/NeoFreeBird-sideloaded.ipa?${TIMESTAMP}`,
                        downloads: 0
                    },
                    {
                        id: 'inshot',
                        name: 'InShot Pro',
                        developer: 'IPAOMTK',
                        description: 'Pro video editor with premium filters, tools, and no watermark. App v1.91.1.',
                        icon: `https://OofMini.github.io/Minis-IPA-Repo/apps/Inshot.png?${TIMESTAMP}`,
                        version: '1.91.1',
                        downloadUrl: `https://github.com/OofMini/Minis-Heap/releases/download/New/InShot.ipa?${TIMESTAMP}`,
                        downloads: 0
                    },
                    {
                        id: 'appstoreplus',
                        name: 'Appstore++',
                        developer: 'cokernutx',
                        description: 'Appstore++ allows users to downgrade apps.',
                        icon: `https://OofMini.github.io/Minis-IPA-Repo/apps/appstore.png?${TIMESTAMP}`,
                        version: '1.0.3',
                        downloadUrl: `https://github.com/OofMini/Minis-Heap/releases/download/App%2B%2B/AppStore++_TrollStore_v1.0.3-2.ipa?${TIMESTAMP}`,
                        downloads: 0
                    },
                    {
                        id: 'itorrent',
                        name: 'iTorrent',
                        developer: 'XITRIX',
                        description: 'Lightweight torrent client for downloading and managing torrent files on-device.',
                        icon: `https://OofMini.github.io/Minis-IPA-Repo/apps/itorrent.png?${TIMESTAMP}`,
                        version: '2.1.0',
                        downloadUrl: `https://github.com/OofMini/Minis-Heap/releases/download/Torrent/iTorrent.ipa?${TIMESTAMP}`,
                        downloads: 0
                    },
                    {
                        id: 'livecontainer',
                        name: 'LiveContainer',
                        developer: 'hugeBlack',
                        description: 'Runs live production containers for streaming apps and runtime isolation.',
                        icon: `https://OofMini.github.io/Minis-IPA-Repo/apps/livecontainer.png?${TIMESTAMP}`,
                        version: '3.6.1',
                        downloadUrl: `https://github.com/OofMini/Minis-Heap/releases/download/Live/LiveContainer.ipa?${TIMESTAMP}`,
                        downloads: 0
                    },
                    {
                        id: 'refacepro',
                        name: 'RefacePro (IOS 17+)',
                        developer: 'IPAOMTK',
                        description: 'Reface Premium Unlocked.',
                        icon: `https://OofMini.github.io/Minis-IPA-Repo/apps/refacepro.png?${TIMESTAMP}`,
                        version: '5.27.0',
                        downloadUrl: `https://github.com/OofMini/Minis-Heap/releases/download/Reface/Reface.ipa?${TIMESTAMP}`,
                        downloads: 0
                    }
                ];
            }

            async load() {
                try {
                    this.apps = this.getAppsData();
                    this.filteredApps = [...this.apps];
                    this.cacheTimestamp = Date.now();
                    return true;
                } catch (error) {
                    throw new AppError('Failed to load apps data', 'error');
                }
            }

            filter(searchTerm) {
                const now = Date.now();
                if (now - this.cacheTimestamp > CONFIG.CACHE_TTL) {
                    this.searchCache.clear();
                }

                const cacheKey = searchTerm.toLowerCase().trim();
                
                if (this.searchCache.has(cacheKey)) {
                    this.filteredApps = this.searchCache.get(cacheKey);
                    return;
                }

                if (!searchTerm) {
                    this.filteredApps = [...this.apps];
                    this.searchCache.set(cacheKey, this.filteredApps);
                    return;
                }

                const term = searchTerm.toLowerCase();
                this.filteredApps = this.apps.filter(app =>
                    app.name.toLowerCase().includes(term) ||
                    app.description.toLowerCase().includes(term) ||
                    app.developer.toLowerCase().includes(term)
                ).slice(0, CONFIG.MAX_SEARCH_RESULTS);

                this.searchCache.set(cacheKey, this.filteredApps);
            }

            getAppById(id) {
                return this.apps.find(app => app.id === id);
            }

            incrementDownloads(id) {
                const app = this.getAppById(id);
                if (app) {
                    app.downloads = (app.downloads || 0) + 1;
                    return app.downloads;
                }
                return 0;
            }
        }

        // ==================== UI MANAGER ====================
        class UIManager {
            constructor() {
                this.appGrid = document.getElementById('appGrid');
                this.searchBox = document.getElementById('searchBox');
                this.toast = document.getElementById('toast');
                this.observer = null;
                this.dataManager = new DataManager();
            }

            init() {
                this.initIntersectionObserver();
                this.setupSearch();
                this.setupEventListeners();
                this.loadApps();
            }

            initIntersectionObserver() {
                this.observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
            }

            setupSearch() {
                if (!this.searchBox) return;

                const handleSearch = Utils.debounce((value) => {
                    this.dataManager.filter(value);
                    this.renderAppGrid();
                }, CONFIG.SEARCH_DEBOUNCE);

                this.searchBox.addEventListener('input', (e) => {
                    handleSearch(e.target.value.trim());
                });

                // Clear search on escape
                this.searchBox.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.searchBox.value = '';
                        handleSearch('');
                    }
                });
            }

            setupEventListeners() {
                // Download button delegation
                this.appGrid?.addEventListener('click', (e) => {
                    const button = e.target.closest('.download-btn');
                    if (button) {
                        const appId = button.dataset.appId;
                        if (appId) {
                            this.handleDownload(appId);
                        }
                    }
                });

                // Network status
                window.addEventListener('online', () => {
                    this.showToast('Connection restored', 'success');
                });

                window.addEventListener('offline', () => {
                    this.showToast('You are currently offline', 'warning');
                });

                if (!navigator.onLine) {
                    this.showToast('You are currently offline', 'warning');
                }
            }

            async loadApps() {
                this.showSkeletonLoading();
                
                try {
                    await this.dataManager.load();
                    
                    // Simulate loading delay
                    await new Promise(resolve => 
                        setTimeout(resolve, CONFIG.SKELETON_DELAY)
                    );
                    
                    this.renderAppGrid();
                } catch (error) {
                    this.showError(error.message);
                }
            }

            showSkeletonLoading() {
                if (!this.appGrid) return;

                const skeletonHTML = Array(6).fill(`
                    <div class="skeleton-card fade-in">
                        <div class="skeleton skeleton-icon"></div>
                        <div class="skeleton skeleton-text short"></div>
                        <div class="skeleton skeleton-text medium"></div>
                        <div class="skeleton skeleton-text medium"></div>
                        <div class="skeleton skeleton-button"></div>
                    </div>
                `).join('');

                this.appGrid.innerHTML = skeletonHTML;
                this.observeElements(this.appGrid.querySelectorAll('.fade-in'));
            }

            showError(message) {
                if (!this.appGrid) return;

                this.appGrid.innerHTML = `
                    <div class="error-state fade-in" role="alert">
                        <div class="error-emoji" aria-hidden="true">üòï</div>
                        <h3 class="error-title">Unable to Load Apps</h3>
                        <p class="error-message">${Utils.escapeHtml(message)}</p>
                        <button type="button" class="download-btn" onclick="window.location.reload()">
                            üîÑ Retry
                        </button>
                    </div>
                `;

                this.observeElements(this.appGrid.querySelectorAll('.fade-in'));
            }

            renderAppGrid() {
                if (!this.appGrid) return;

                const apps = this.dataManager.filteredApps;
                
                if (!apps.length) {
                    this.appGrid.innerHTML = `
                        <div class="fade-in" style="grid-column:1/-1;text-align:center;padding:40px">
                            <h3>No apps found</h3>
                            <p>Try different search terms</p>
                        </div>
                    `;
                    
                    this.observeElements(this.appGrid.querySelectorAll('.fade-in'));
                    return;
                }

                const html = apps.map((app, index) => {
                    const safeName = Utils.escapeHtml(app.name);
                    const safeDeveloper = Utils.escapeHtml(app.developer);
                    const safeDescription = Utils.escapeHtml(app.description);
                    const downloads = app.downloads || 0;
                    const encodedId = Utils.encodeAppId(app.id);
                    const downloadUrl = encodeURI(app.downloadUrl);

                    return `
                    <article class="app-card fade-in stagger-${(index % 3) + 1}" 
                             aria-label="${safeName}">
                        <div class="app-icon-container">
                            <img src="${app.icon}" 
                                 alt="Icon for ${safeName}" 
                                 class="app-icon" 
                                 loading="lazy" 
                                 width="80" 
                                 height="80"
                                 onerror="this.onerror=null;this.src='https://OofMini.github.io/Minis-IPA-Repo/apps/repo-icon.png?${TIMESTAMP}'">
                        </div>
                        <div class="app-status">
                            <span aria-label="Status fully working">‚úÖ Fully Working</span> ‚Ä¢ v${app.version}
                            <span class="download-count" aria-label="Download count">
                                ${Utils.formatNumber(downloads)} downloads
                            </span>
                        </div>
                        <div class="app-card-content">
                            <h3>${safeName}</h3>
                            <p>By <b>${safeDeveloper}</b><br>${safeDescription}</p>
                            <button type="button" 
                                    class="download-btn" 
                                    data-app-id="${encodedId}"
                                    data-download-url="${downloadUrl}"
                                    aria-label="Download ${safeName}">
                                ‚¨áÔ∏è Download IPA
                            </button>
                        </div>
                    </article>
                    `;
                }).join('');

                this.appGrid.innerHTML = html;
                this.observeElements(this.appGrid.querySelectorAll('.fade-in'));
            }

            observeElements(elements) {
                if (this.observer && elements.length) {
                    elements.forEach(el => this.observer.observe(el));
                }
            }

            async handleDownload(appId) {
                try {
                    const decodedId = Utils.decodeAppId(appId);
                    const app = this.dataManager.getAppById(decodedId);
                    
                    if (!app) {
                        throw new AppError('App not found');
                    }

                    if (!Utils.isValidUrl(app.downloadUrl)) {
                        throw new AppError('Invalid download URL');
                    }

                    if (!navigator.onLine) {
                        const copied = await Utils.copyToClipboard(app.downloadUrl);
                        this.showToast(
                            copied ? 'URL copied to clipboard' : 'Failed to copy URL',
                            copied ? 'info' : 'error'
                        );
                        return;
                    }

                    this.dataManager.incrementDownloads(decodedId);
                    this.showToast(`Downloading ${app.name}...`, 'info');

                    // Open download in new tab
                    setTimeout(() => {
                        const link = document.createElement('a');
                        link.href = app.downloadUrl;
                        link.target = '_blank';
                        link.rel = 'noopener noreferrer';
                        link.click();
                    }, 300);

                } catch (error) {
                    this.showToast(
                        error instanceof AppError ? error.message : 'Download failed',
                        'error'
                    );
                }
            }

            showToast(message, type = 'info') {
                if (!this.toast) return;

                // Clear existing toast
                clearTimeout(toastTimeout);
                this.toast.textContent = '';
                this.toast.className = 'toast';
                this.toast.classList.add(type);
                
                // Use text node for safety
                this.toast.appendChild(document.createTextNode(message));
                this.toast.classList.add('show');

                toastTimeout = setTimeout(() => {
                    this.toast.classList.remove('show');
                }, CONFIG.TOAST_DURATION);
            }

            cleanup() {
                if (this.observer) {
                    this.observer.disconnect();
                }
                clearTimeout(toastTimeout);
            }
        }

        // ==================== PWA & INSTALLATION ====================
        class PWAInstaller {
            constructor() {
                this.deferredPrompt = null;
                this.uiManager = null;
                this.installToastTimeout = null;
            }

            init(uiManager) {
                this.uiManager = uiManager;
                this.setupListeners();
                
                // Deferred service worker registration
                if ('serviceWorker' in navigator && location.protocol === 'https:') {
                    setTimeout(() => {
                        navigator.serviceWorker.register('./sw.js?' + TIMESTAMP)
                            .catch(console.error);
                    }, 1000);
                }
            }

            setupListeners() {
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.deferredPrompt = e;
                    setTimeout(() => this.showInstallPrompt(), 5000);
                });
            }

            showInstallPrompt() {
                if (!this.deferredPrompt || !this.uiManager?.toast) return;

                clearTimeout(this.installToastTimeout);
                const toast = this.uiManager.toast;
                toast.textContent = '';
                toast.className = 'toast info show';

                const prompt = document.createElement('div');
                prompt.className = 'install-prompt';
                
                const text = document.createTextNode("Install Mini's IPA Repo? ");
                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = 'Install';
                button.onclick = () => this.install();
                
                prompt.appendChild(text);
                prompt.appendChild(button);
                toast.appendChild(prompt);

                this.installToastTimeout = setTimeout(() => {
                    toast.classList.remove('show');
                }, CONFIG.TOAST_DURATION);
            }

            async install() {
                if (!this.deferredPrompt) return;

                this.deferredPrompt.prompt();
                const { outcome } = await this.deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    this.uiManager?.showToast('App installed successfully!', 'success');
                }
                
                this.deferredPrompt = null;
                clearTimeout(this.installToastTimeout);
            }

            cleanup() {
                clearTimeout(this.installToastTimeout);
                this.deferredPrompt = null;
            }
        }

        // ==================== MAIN APP INITIALIZATION ====================
        class App {
            constructor() {
                this.uiManager = null;
                this.installer = null;
                this.initialized = false;
            }

            async init() {
                if (this.initialized) return;

                try {
                    // Initialize UI
                    this.uiManager = new UIManager();
                    this.uiManager.init();
                    
                    // Initialize PWA installer
                    this.installer = new PWAInstaller();
                    this.installer.init(this.uiManager);
                    
                    // Setup global functions
                    this.setupGlobalFunctions();
                    
                    this.initialized = true;
                } catch (error) {
                    console.error('App initialization failed:', error);
                    if (this.uiManager) {
                        this.uiManager.showToast('Failed to initialize app', 'error');
                    }
                }
            }

            setupGlobalFunctions() {
                window.addToApp = (appName) => {
                    const schemes = {
                        'TrollApps': 'trollapps',
                        'SideStore': 'sidestore',
                        'Feather': 'feather'
                    };
                    
                    const manifests = {
                        'TrollApps': 'trollapps.json',
                        'SideStore': 'sidestore.json',
                        'Feather': 'feather.json'
                    };
                    
                    const scheme = schemes[appName];
                    const manifest = manifests[appName];
                    
                    if (!scheme || !manifest) {
                        this.uiManager?.showToast('Invalid app selection', 'error');
                        return;
                    }
                    
                    const url = `${scheme}://add-repo?url=${encodeURIComponent(`https://oofmini.github.io/Minis-IPA-Repo/${manifest}?${TIMESTAMP}`)}`;
                    
                    // Try to open the app
                    window.location.href = url;
                    
                    // Fallback message
                    setTimeout(() => {
                        this.uiManager?.showToast(
                            `If ${appName} didn't open, make sure it's installed`,
                            'info'
                        );
                    }, 1000);
                };
            }

            cleanup() {
                if (this.uiManager) {
                    this.uiManager.cleanup();
                }
                if (this.installer) {
                    this.installer.cleanup();
                }
                this.initialized = false;
            }
        }

        // ==================== ENTRY POINT ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Create and initialize app
            const app = new App();
            app.init();

            // Handle page visibility changes
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden') {
                    // Cleanup when page is hidden
                    app.cleanup();
                }
            });

            // Cleanup on page unload
            window.addEventListener('beforeunload', () => {
                app.cleanup();
            });

            // Make app available globally for debugging
            if (window.location.hostname === 'localhost') {
                window.app = app;
            }
        });

        // Handle service worker updates
        if ('serviceWorker' in navigator) {
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });
        }
    </script>
</body>
</html>